# Istio Add-On Module release v4.0.0

Welcome to the latest release of `Istio` module of [`SIGHUP Distribution`](https://github.com/sighupio/distribution) maintained by team SIGHUP.

This is a major release that:

- Adds support for Kubernetes 1.31 and 1.32
- Updates Istio to version 1.25.2
  - `BREAKING CHANGE`: removes Istio Operator support (deprecated upstream); now using direct manifest installation approach
- Introduces a new profile-based installation structure
- Reorganizes the code structure
- Updates Kiali to version 2.9.0
- Updates Jaeger to version 1.65.0

## Included packages

| Package         | Current Version                                                           | Previous Version |
| --------------  | ------------------------------------------------------------------------- | ---------------- |
| `istio-opertor` |     `Deprecated`        |  [`v1.23.3`](https://github.com/istio/istio/releases/tag/1.23.3)   |
| `istio`         | [`v1.25.2`](https://github.com/istio/istio/releases/tag/1.25.2)           | `New package`    |
| `kiali`         | [`v2.9.0`](https://github.com/kiali/kiali/releases/tag/v2.9.0)            | `v2.0.0`         |
| `jaeger`        | [`v1.65.0`](https://github.com/jaegertracing/jaeger/releases/tag/v1.65.0) | `v1.62.0`        |


## Upgrade Guide 🦮

### Upgrade Module version

1. Update the version in your `Furyfile.yaml` file:

```yaml
versions:
  service-mesh: v4.0.0

bases:
  - name: service-mesh
```

2. Download the module:

```bash
furyctl legacy vendor -H
```

### Upgrade Procedure Istio and Jaeger

⚠️ This Istio release includes a breaking change, this will cause downtime while performing the upgrade.

1. Choose your preferred profile and align your patches (if you have any)

2. Delete the operator resources:

```shell
kubectl -n istio-operator delete deployment istio-operator
kubectl delete customresourcedefinitions istiooperators.install.istio.io
kubectl -n istio-system patch istiooperators.install.istio.io istio -p '{"metadata":{"finalizers":[]}}' --type=merge
```
3. Analyze the differences against your environment:

```shell
cd examples/istio/
kustomize build . | kubectl diff -f - > diff.diff
```
4. Finally, apply the new manifests, e.g.:

```shell
cd examples/istio-base/
kustomize build . | kubectl apply -f -
```
5. Delete old istio-operator resources (from istio-operator namespace):

```shell
kubectl -n istio-operator delete deployment istio-operator
kubectl -n istio-operator delete serviceaccount istio-operator
kubectl -n istio-operator delete service istio-operator
kubectl delete clusterrole istio-operator
kubectl delete clusterrolebinding istio-operator
kubectl delete namespace istio-operator
```
